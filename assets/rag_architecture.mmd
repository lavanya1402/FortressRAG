flowchart TB

subgraph UI["Client / API Layer"]
A1["POST /ingest"]
A2["POST /chat"]
end

subgraph ING["Ingestion Layer"]
B1["PDF Reader"]
B2["Chunking with Page Tracking"]
B3["SHA256 Hashing"]
end

subgraph GOV["Governance Layer"]
C1["Manifest JSON"]
C2["Version Control"]
C3["Duplicate Detection"]
end

subgraph EMB["Embedding Layer"]
D1["OpenAI Embeddings"]
D2["FAISS Index"]
end

subgraph RET["Query Pipeline"]
E1["Similarity Search (Top K)"]
E2["Optional LLM Reranker (Top N)"]
E3["Context Builder"]
E4["LLM Answer Generation"]
end

A1 --> B1 --> B2 --> B3 --> C1 --> D1 --> D2
A2 --> E1 --> E2 --> E3 --> E4